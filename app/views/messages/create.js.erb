<% if @message.new_record? %>
  $('#js-topic-id-<%= @message.topic.id %>').find('#new_message').effect('shake');
<% else %>
  $('#js-topic-id-<%= @message.topic.id %>').find('.js-messages').append('<%=j render partial: 'messages/message', object: @message %>');
  $('#js-topic-id-<%= @message.topic.id %>').find('.js-messages').show();
  var form = $('#js-topic-id-<%= @message.topic.id %>').find('#new_message');
  form.find('#message_text').val('');
  form.find('#message_attachment_ids').val('');
  form.find('.attachments').html('');
<% end %>